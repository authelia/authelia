<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Architecture - Authelia</title> <link rel="shortcut icon" href="https://docs.authelia.com/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="https://docs.authelia.com/assets/css/just-the-docs.css"> <script type="text/javascript" src="https://docs.authelia.com/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="https://docs.authelia.com/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Architecture | Authelia</title> <meta name="generator" content="Jekyll v3.8.5" /> <meta property="og:title" content="Architecture" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Authelia is an open source multi-factor single sign-on portal for web applications" /> <meta property="og:description" content="Authelia is an open source multi-factor single sign-on portal for web applications" /> <link rel="canonical" href="https://docs.authelia.com/home/architecture.html" /> <meta property="og:url" content="https://docs.authelia.com/home/architecture.html" /> <meta property="og:site_name" content="Authelia" /> <script type="application/ld+json"> {"@type":"WebPage","url":"https://docs.authelia.com/home/architecture.html","headline":"Architecture","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://docs.authelia.com/images/authelia-title.png"}},"description":"Authelia is an open source multi-factor single sign-on portal for web applications","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"> <title>Link</title> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg> <div class="page-wrap"> <div class="side-bar"> <div class="site-header"> <a href="https://docs.authelia.com" class="site-title lh-tight"> <div class="site-logo"></div> </a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button> </div> <div class="navigation main-nav js-main-nav"> <nav role="navigation" aria-label="Main navigation"> <ul class="navigation-list"><li class="navigation-list-item active"><a href="https://docs.authelia.com/" class="navigation-list-link">Home</a><ul class="navigation-list-child-list "><li class="navigation-list-item active"><a href="https://docs.authelia.com/home/architecture.html" class="navigation-list-link active">Architecture</a></li></ul></li><li class="navigation-list-item"><a href="https://docs.authelia.com/getting-started.html" class="navigation-list-link">Getting Started</a></li><li class="navigation-list-item"><a href="https://docs.authelia.com/features/" class="navigation-list-link">Features</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="https://docs.authelia.com/features/first-factor.html" class="navigation-list-link">First Factor</a></li><li class="navigation-list-item "><a href="https://docs.authelia.com/features/2fa/" class="navigation-list-link">Second Factor</a><ul class="navigation-list-child-list"><li class="navigation-list-item "> <a href="https://docs.authelia.com/features/2fa/one-time-password.html" class="navigation-list-link">One-Time Password</a> </li><li class="navigation-list-item "> <a href="https://docs.authelia.com/features/2fa/security-key.html" class="navigation-list-link">Security Keys</a> </li><li class="navigation-list-item "> <a href="https://docs.authelia.com/features/2fa/push-notifications.html" class="navigation-list-link">Push Notification</a> </li></ul></li><li class="navigation-list-item "><a href="https://docs.authelia.com/features/single-factor.html" class="navigation-list-link">Single Factor</a></li><li class="navigation-list-item "><a href="https://docs.authelia.com/features/password-reset.html" class="navigation-list-link">Password Reset</a></li><li class="navigation-list-item "><a href="https://docs.authelia.com/features/access-control.html" class="navigation-list-link">Access Control</a></li><li class="navigation-list-item "><a href="https://docs.authelia.com/features/regulation.html" class="navigation-list-link">Regulation</a></li></ul></li><li class="navigation-list-item"><a href="https://docs.authelia.com/configuration/" class="navigation-list-link">Configuration</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="https://docs.authelia.com/configuration/authentication/" class="navigation-list-link">Authentication backends</a><ul class="navigation-list-child-list"><li class="navigation-list-item "> <a href="https://docs.authelia.com/configuration/authentication/file.html" class="navigation-list-link">File</a> </li><li class="navigation-list-item "> <a href="https://docs.authelia.com/configuration/authentication/ldap.html" class="navigation-list-link">LDAP</a> </li></ul></li><li class="navigation-list-item "><a href="https://docs.authelia.com/configuration/access-control.html" class="navigation-list-link">Access Control</a></li><li class="navigation-list-item "><a href="https://docs.authelia.com/configuration/duo-push-notifications.html" class="navigation-list-link">Duo Push Notifications</a></li><li class="navigation-list-item "><a href="https://docs.authelia.com/configuration/google-analytics.html" class="navigation-list-link">Google Analytics</a></li><li class="navigation-list-item "><a href="https://docs.authelia.com/configuration/miscellaneous.html" class="navigation-list-link">Miscellaneous</a></li><li class="navigation-list-item "><a href="https://docs.authelia.com/configuration/one-time-password.html" class="navigation-list-link">One-Time Password</a></li><li class="navigation-list-item "><a href="https://docs.authelia.com/configuration/notifier/" class="navigation-list-link">Notifier</a><ul class="navigation-list-child-list"><li class="navigation-list-item "> <a href="https://docs.authelia.com/configuration/notifier/filesystem.html" class="navigation-list-link">Filesystem</a> </li><li class="navigation-list-item "> <a href="https://docs.authelia.com/configuration/notifier/smtp.html" class="navigation-list-link">SMTP</a> </li></ul></li><li class="navigation-list-item "><a href="https://docs.authelia.com/configuration/regulation.html" class="navigation-list-link">Regulation</a></li><li class="navigation-list-item "><a href="https://docs.authelia.com/configuration/secrets.html" class="navigation-list-link">Secrets</a></li><li class="navigation-list-item "><a href="https://docs.authelia.com/configuration/session.html" class="navigation-list-link">Session</a></li><li class="navigation-list-item "><a href="https://docs.authelia.com/configuration/storage/" class="navigation-list-link">Storage backends</a><ul class="navigation-list-child-list"><li class="navigation-list-item "> <a href="https://docs.authelia.com/configuration/storage/mariadb.html" class="navigation-list-link">MariaDB</a> </li><li class="navigation-list-item "> <a href="https://docs.authelia.com/configuration/storage/postgres.html" class="navigation-list-link">PostgreSQL</a> </li><li class="navigation-list-item "> <a href="https://docs.authelia.com/configuration/storage/mysql.html" class="navigation-list-link">MySQL</a> </li><li class="navigation-list-item "> <a href="https://docs.authelia.com/configuration/storage/sqlite.html" class="navigation-list-link">SQLite</a> </li></ul></li></ul></li><li class="navigation-list-item"><a href="https://docs.authelia.com/deployment/" class="navigation-list-link">Deployment</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="https://docs.authelia.com/deployment/deployment-lite.html" class="navigation-list-link">Deployment - Lite</a></li><li class="navigation-list-item "><a href="https://docs.authelia.com/deployment/deployment-ha.html" class="navigation-list-link">Deployment - Highly-Available</a></li><li class="navigation-list-item "><a href="https://docs.authelia.com/deployment/deployment-kubernetes.html" class="navigation-list-link">Deployment - Kubernetes</a></li><li class="navigation-list-item "><a href="https://docs.authelia.com/deployment/supported-proxies/" class="navigation-list-link">Proxy Integration</a><ul class="navigation-list-child-list"><li class="navigation-list-item "> <a href="https://docs.authelia.com/deployment/supported-proxies/nginx.html" class="navigation-list-link">Nginx</a> </li><li class="navigation-list-item "> <a href="https://docs.authelia.com/deployment/supported-proxies/traefik1.x.html" class="navigation-list-link">Traefik 1.x</a> </li><li class="navigation-list-item "> <a href="https://docs.authelia.com/deployment/supported-proxies/traefik2.x.html" class="navigation-list-link">Traefik 2.x</a> </li></ul></li></ul></li><li class="navigation-list-item"><a href="https://docs.authelia.com/security/" class="navigation-list-link">Security</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="https://docs.authelia.com/security/measures.html" class="navigation-list-link">Security Measures</a></li></ul></li><li class="navigation-list-item"><a href="https://docs.authelia.com/contributing/" class="navigation-list-link">Contributing</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="https://docs.authelia.com/contributing/authelia-scripts.html" class="navigation-list-link">Authelia Scripts</a></li><li class="navigation-list-item "><a href="https://docs.authelia.com/contributing/build-and-dev.html" class="navigation-list-link">Build & Dev</a></li><li class="navigation-list-item "><a href="https://docs.authelia.com/contributing/suites.html" class="navigation-list-link">Suites</a></li></ul></li><li class="navigation-list-item"><a href="https://docs.authelia.com/community/" class="navigation-list-link">Community</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="https://docs.authelia.com/community/two-factor-basic-auth.html" class="navigation-list-link">2FA through basic auth</a></li></ul></li></ul> </nav> </div> <footer class="site-footer"> <p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p> </footer> </div> <div class="main-content-wrap js-main-content" tabindex="0"> <div class="main-content"> <div class="page-header js-page-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search Authelia" aria-label="Search Authelia" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg> </div> <div class="js-search-results search-results-wrap"></div> </div> </div> <div class="page"> <nav class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="https://docs.authelia.com/">Home</a></li> <li class="breadcrumb-nav-list-item"><span>Architecture</span></li> </ol> </nav> <div id="main-content" class="page-content" role="main"> <h1 id="architecture"> <a href="#architecture" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Architecture </h1> <p><strong>Authelia</strong> is a companion of reverse proxies like Nginx, Traefik and HAProxy. It can be seen as an extension of those proxies providing authentication functions and a login portal.</p> <p>As shown in the following architecture diagram, Authelia is directly connected to the reverse proxy but never directly connected to application backends.</p> <p align="center" style="margin:50px"> <img src="../images/archi.png" /> </p> <h2 id="workflow"> <a href="#workflow" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Workflow </h2> <p>Reverse proxies are configured so that every incoming request generates an authentication request sent to Authelia. Authelia responds and will instruct the reverse proxy to either allow the incoming request to pass through, or block it because the user is not authenticated or is not sufficiently authorized.</p> <h3 id="step-by-step"> <a href="#step-by-step" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Step by step </h3> <p>When the first request of an unauthenticated user hits the reverse proxy, Authelia determines the user is not authenticated because no session cookie has been sent along with the request. Consequently, Authelia redirects the user to the authentication portal provided by Authelia itself. The user can then execute the authentication workflow using that portal to obtain a session cookie valid for all subdomains of the domain protected by Authelia.</p> <p>When the user visits the initial website again, the query is sent along with the session cookie which is forwarded in the authentication request to Authelia. This time, Authelia can verify the user is authenticated and order the reverse proxy to let the query pass through.</p> <h3 id="sequence-diagram"> <a href="#sequence-diagram" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Sequence Diagram </h3> <p>Here is a description of the complete workflow:</p> <p align="center"> <img src="../images/sequence-diagram.png" /> </p> <h2 id="httphttps"> <a href="#httphttps" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> HTTP/HTTPS </h2> <p>Authelia only works for websites served over HTTPS because the session cookie can only be transmitted over secure connections. Please note that it has been decided that we wonâ€™t support websites served over HTTP in order to avoid any risk due to misconfiguration. (see <a href="https://github.com/authelia/authelia/issues/590">#590</a>).</p> <p>If a self-signed certificate is required, the following command can be used to generate one:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Generate a certificate covering "example.com" for one year in the /tmp/certs/ directory.
$ docker run authelia/authelia authelia certificates generate --host example.com --dir /tmp/certs/
</code></pre></div></div> <hr> <footer role="contentinfo"> <p class="text-small text-grey-dk-000 mb-0">Copyright &copy; 2020 Authelia. Distributed by an <a href="https://github.com/authelia/authelia/blob/master/LICENSE">Apache 2.0 license.</a></p> </footer> </div> </div> </div> </div> </body> </html>
