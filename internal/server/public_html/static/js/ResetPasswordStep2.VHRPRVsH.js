import{u as I,m as z,r,c as W,p as A,g as B,s as F,j as t,G as d,t as K,I as C}from"./index.ChPl_EQa.js";import{P as k,g as L,a as V}from"./PasswordPolicyConfiguration.Dpq6E4aP.js";import{M as Y}from"./MinimalLayout.F-MLLyjG.js";import{c as G,r as U}from"./ResetPassword.BdxBp78C.js";import{F as O,T as S}from"./mui.TextField.DZvnmAl7.js";import{I as Q,V as H,a as J}from"./mui.VisibilityOff.BhqAOdMe.js";import{B as T}from"./constants.BMlb_xNc.js";import"./usePortalStyles.BPzryqBs.js";const ie=function(){const{t:s}=I(),{classes:n,cx:f}=X(),[u,l]=r.useState(!0),[i,w]=r.useState(""),[c,h]=r.useState(""),[D,y]=r.useState(!1),[N,x]=r.useState(!1),{createSuccessNotification:R,createErrorNotification:a}=W(),g=A(),[p,o]=r.useState(!1),[P,E]=r.useState({max_length:0,min_length:8,min_score:0,require_lowercase:!1,require_number:!1,require_special:!1,require_uppercase:!1,mode:k.Disabled}),m=B(F),b=r.useCallback(e=>{a(s("You have made too many requests"))},[a,s]),v=r.useCallback(async()=>{if(!m){l(!0),a(s("No verification token provided"));return}try{l(!0);const e=await G(m);if(e&&e.limited){b(e.retryAfter);return}const _=await L();E(_),l(!1)}catch(e){console.error(e),a(s("There was an issue completing the process the verification token might have expired")),l(!0)}},[m,a,s,b]);r.useEffect(()=>{v()},[v]);const j=async()=>{if(w(""),h(""),i===""||c===""){i===""&&y(!0),c===""&&x(!0);return}if(i!==c){y(!0),x(!0),a(s("Passwords do not match"));return}l(!0);try{await U(i),R(s("Password has been reset")),setTimeout(()=>g(C),1500)}catch(e){console.error(e),e.message.includes("0000052D.")||e.message.includes("policy")?a(s("Your supplied password does not meet the password policy requirements")):a(s("There was an issue resetting the password"))}},q=()=>j(),M=()=>g(C);return t.jsx(Y,{title:s("Enter new password"),id:"reset-password-step2-stage",children:t.jsx(O,{id:"form-reset-password",children:t.jsxs(d,{container:!0,className:n.root,spacing:2,children:[t.jsxs(d,{size:{xs:12},children:[t.jsx(S,{id:"password1-textfield",label:s("New password"),variant:"outlined",type:p?"text":"password",value:i,disabled:u,onChange:e=>w(e.target.value),error:D,className:f(n.fullWidth),autoComplete:"new-password",slotProps:{input:{endAdornment:t.jsx(Q,{position:"end",children:t.jsx(K,{"aria-label":"toggle password visibility",edge:"end",size:"large",onMouseDown:()=>o(!0),onMouseUp:()=>o(!1),onMouseLeave:()=>o(!1),onTouchStart:()=>o(!0),onTouchEnd:()=>o(!1),onTouchCancel:()=>o(!1),onKeyDown:e=>{e.key===" "&&(o(!0),e.preventDefault())},onKeyUp:e=>{e.key===" "&&(o(!1),e.preventDefault())},children:p?t.jsx(H,{}):t.jsx(J,{})})})}}}),P.mode===k.Disabled?null:t.jsx(V,{value:i,policy:P})]}),t.jsx(d,{size:{xs:12},children:t.jsx(S,{id:"password2-textfield",label:s("Repeat new password"),variant:"outlined",type:p?"text":"password",disabled:u,value:c,onChange:e=>h(e.target.value),error:N,onKeyDown:e=>{e.key==="Enter"&&(j(),e.preventDefault())},className:f(n.fullWidth),autoComplete:"new-password"})}),t.jsx(d,{size:{xs:6},children:t.jsx(T,{id:"reset-button",variant:"contained",color:"primary",name:"password1",disabled:u,onClick:q,className:n.fullWidth,children:s("Reset")})}),t.jsx(d,{size:{xs:6},children:t.jsx(T,{id:"cancel-button",variant:"contained",color:"primary",name:"password2",onClick:M,className:n.fullWidth,children:s("Cancel")})})]})})})},X=z()(s=>({root:{marginTop:s.spacing(2),marginBottom:s.spacing(2)},fullWidth:{width:"100%"}}));export{ie as default};
