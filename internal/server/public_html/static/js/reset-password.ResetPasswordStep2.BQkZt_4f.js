import{u as I,m as z,r as a,c as W,p as A,g as B,s as F,j as t,G as d,t as K,I as C}from"./index.BAKKlMLi.js";import{P as k,g as L,a as V}from"./services.PasswordPolicyConfiguration.CGX-5x9v.js";import{M as Y}from"./layouts.Minimal.B6c8ZNmT.js";import{c as G,r as U}from"./reset-password.ResetPassword.DMm-pI9b.js";import{F as O,T as S}from"./mui.TextField.DDjkj3Bi.js";import{I as Q,V as H,a as J}from"./mui.VisibilityOff.BlDave3-.js";import{B as T}from"./constants.constants.Dc-vougk.js";import"./layouts.usePortalStyles.DPt9DQ4Y.js";const ie=function(){const{t:s}=I(),{classes:l,cx:h}=X(),[u,o]=a.useState(!0),[n,y]=a.useState(""),[c,x]=a.useState(""),[D,p]=a.useState(!1),[N,f]=a.useState(!1),{createSuccessNotification:R,createErrorNotification:r}=W(),g=A(),[m,i]=a.useState(!1),[P,E]=a.useState({max_length:0,min_length:8,min_score:0,require_lowercase:!1,require_number:!1,require_special:!1,require_uppercase:!1,mode:k.Disabled}),w=B(F),b=a.useCallback(e=>{r(s("You have made too many requests")),o(!1)},[r,s]),v=a.useCallback(async()=>{if(!w){o(!0),r(s("No verification token provided"));return}try{o(!0);const e=await G(w);if(e&&e.limited){b(e.retryAfter),o(!1);return}const _=await L();E(_),o(!1)}catch(e){console.error(e),r(s("There was an issue completing the process the verification token might have expired")),o(!0)}},[w,r,s,b]);a.useEffect(()=>{v()},[v]);const j=async()=>{if(p(!1),f(!1),n===""||c===""){n===""&&p(!0),c===""&&f(!0);return}if(n!==c){p(!0),f(!0),r(s("Passwords do not match"));return}o(!0);try{await U(n),R(s("Password has been reset")),y(""),x(""),setTimeout(()=>g(C),1500)}catch(e){console.error(e),e.message.includes("0000052D.")||e.message.includes("policy")?r(s("Your supplied password does not meet the password policy requirements")):r(s("There was an issue resetting the password")),o(!1)}},q=()=>j(),M=()=>g(C);return t.jsx(Y,{title:s("Enter new password"),id:"reset-password-step2-stage",children:t.jsx(O,{id:"form-reset-password",children:t.jsxs(d,{container:!0,className:l.root,spacing:2,children:[t.jsxs(d,{size:{xs:12},children:[t.jsx(S,{id:"password1-textfield",label:s("New password"),variant:"outlined",type:m?"text":"password",value:n,disabled:u,onChange:e=>y(e.target.value),error:D,className:h(l.fullWidth),autoComplete:"new-password",slotProps:{input:{endAdornment:t.jsx(Q,{position:"end",children:t.jsx(K,{"aria-label":"toggle password visibility",edge:"end",size:"large",onMouseDown:()=>i(!0),onMouseUp:()=>i(!1),onMouseLeave:()=>i(!1),onTouchStart:()=>i(!0),onTouchEnd:()=>i(!1),onTouchCancel:()=>i(!1),onKeyDown:e=>{e.key===" "&&(i(!0),e.preventDefault())},onKeyUp:e=>{e.key===" "&&(i(!1),e.preventDefault())},children:m?t.jsx(H,{}):t.jsx(J,{})})})}}}),P.mode===k.Disabled?null:t.jsx(V,{value:n,policy:P})]}),t.jsx(d,{size:{xs:12},children:t.jsx(S,{id:"password2-textfield",label:s("Repeat new password"),variant:"outlined",type:m?"text":"password",disabled:u,value:c,onChange:e=>x(e.target.value),error:N,onKeyDown:e=>{e.key==="Enter"&&(j(),e.preventDefault())},className:h(l.fullWidth),autoComplete:"new-password"})}),t.jsx(d,{size:{xs:6},children:t.jsx(T,{id:"reset-button",variant:"contained",color:"primary",name:"password1",disabled:u,onClick:q,className:l.fullWidth,children:s("Reset")})}),t.jsx(d,{size:{xs:6},children:t.jsx(T,{id:"cancel-button",variant:"contained",color:"primary",name:"password2",onClick:M,className:l.fullWidth,children:s("Cancel")})})]})})})},X=z()(s=>({root:{marginTop:s.spacing(2),marginBottom:s.spacing(2)},fullWidth:{width:"100%"}}));export{ie as default};
