import{u as S,r as e,c as E,j as m,L as P}from"./index.BAKKlMLi.js";import{u as x}from"./hooks.Mounted.Bo5u1Dd8.js";import{S as r,a as I,b as C,O}from"./portal.OTPDial.Bp064Tr3.js";import"./components.SuccessIcon.C6YNXyF1.js";import"./components.TimerIcon.CVDoFX7O.js";import"./constants.constants.Dc-vougk.js";import"./portal.IconWithContext.B8JfCgC5.js";const M=function(R){const{t:o}=S(["settings","portal"]),[c,d]=e.useState(""),[T,s]=e.useState(r.Idle),{createErrorNotification:u}=E(),[n,p,,l]=I(),i=x(),t=e.useRef(null);e.useEffect(()=>()=>{t.current!==null&&(clearTimeout(t.current),t.current=null)},[]),e.useEffect(()=>{l&&(console.error(l),s(r.Failure))},[l,o]),e.useEffect(()=>{p()},[p]);const g=e.useCallback(f=>{t.current&&clearTimeout(t.current),s(r.RateLimited),u(o("You have made too many requests",{ns:"portal"})),t.current=setTimeout(()=>{if(!i.current){t.current=null;return}s(r.Idle),t.current=null},f*1e3)},[u,o,i]),h=e.useCallback(async()=>{const f=`${c}`;if(n&&!(!c||f.length!==n.digits)){try{s(r.InProgress);const a=await C(f);if(!i.current)return;a?a.limited?g(a.retryAfter):s(r.Success):(u(o("The One-Time Password might be wrong",{ns:"portal"})),s(r.Failure))}catch(a){if(console.error(a),!i.current)return;s(r.Failure)}d("")}},[c,n,g,u,o,i]);return e.useEffect(()=>{h().catch(console.error)},[h]),m.jsx(e.Fragment,{children:n&&!l?m.jsx(O,{passcode:c,period:n.period,digits:n.digits,onChange:d,state:T}):m.jsx(P,{})})};export{M as default};
