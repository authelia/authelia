import{u as C,r,c as x,j as f,L as E}from"./index.J4YSomth.js";import{S as t,a as I,b as R,O as F}from"./portal.OTPDial.B6MZu1xd.js";import"./components.SuccessIcon.C3pLKly2.js";import"./components.TimerIcon.CO1b_Yfm.js";import"./constants.constants.BvDkw1BZ.js";import"./portal.IconWithContext.CCYYopkv.js";const L={passcode:"",status:t.Idle};function O(i,n){switch(n.type){case"setPasscode":return{...i,passcode:n.passcode};case"setStatus":return{...i,status:n.status};default:return i}}const A=function(i){const{onSecondFactorSuccess:n}=i,{t:u}=C(["settings","portal"]),[y,e]=r.useReducer(O,L),{passcode:P,status:l}=y,{createErrorNotification:d}=x(),[s,m,,p]=I(),o=r.useRef(null);r.useEffect(()=>()=>{o.current!==null&&(clearTimeout(o.current),o.current=null)},[]),r.useEffect(()=>{p&&(console.error(p),e({status:t.Failure,type:"setStatus"}))},[p]),r.useEffect(()=>{m()},[m]);const g=r.useCallback(a=>{o.current&&clearTimeout(o.current),e({status:t.RateLimited,type:"setStatus"}),d(u("You have made too many requests",{ns:"portal"})),o.current=setTimeout(()=>{e({status:t.Idle,type:"setStatus"}),o.current=null},a*1e3)},[d,u]),S=r.useCallback(async a=>{const h=`${a}`;if(s&&!(!a||h.length!==s.digits)){try{e({status:t.InProgress,type:"setStatus"});const c=await R(h);c?c.limited?g(c.retryAfter):(e({status:t.Success,type:"setStatus"}),n()):(d(u("The One-Time Password might be wrong",{ns:"portal"})),e({status:t.Failure,type:"setStatus"}))}catch(c){console.error(c),e({status:t.Failure,type:"setStatus"})}e({passcode:"",type:"setPasscode"})}},[s,g,d,u,n]),T=r.useCallback(a=>{e({passcode:a,type:"setPasscode"}),s&&a.length===s.digits&&l!==t.InProgress&&l!==t.RateLimited&&S(a)},[s,l,S]);return f.jsx(r.Fragment,{children:s&&!p?f.jsx(F,{passcode:P,period:s.period,digits:s.digits,onChange:T,state:l}):f.jsx(E,{})})};export{A as default};
