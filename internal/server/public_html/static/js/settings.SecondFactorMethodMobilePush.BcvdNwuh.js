import{u as x,m as g,r,c as S,j as n,B as h}from"./index.t7Hp6wWA.js";import{F as j}from"./components.FailureIcon.C8UZ-YzZ.js";import{P as N}from"./components.PushNotificationIcon.Cq18F1CP.js";import{u as P}from"./hooks.Mounted.BhidXhBk.js";import{i as T,c as C,a as E,D as I}from"./portal.DeviceSelectionContainer.DAiU6FbD.js";import{B as R,h as F}from"./constants.constants.D9Jh23gv.js";import"./components.SuccessIcon.BwM3O0fW.js";var B=(t=>(t[t.SignInInProgress=1]="SignInInProgress",t[t.Success=2]="Success",t[t.Failure=3]="Failure",t[t.Selection=4]="Selection",t[t.RateLimited=5]="RateLimited",t))(B||{});const H=function(t){const{t:s}=x("portal"),{classes:p}=L(),[o,c]=r.useState(1),a=P(),[y,b]=r.useState([]),{createErrorNotification:i}=S(),l=r.useRef(null);r.useEffect(()=>()=>{l.current!==null&&(clearTimeout(l.current),l.current=null)},[]);const v=r.useCallback(e=>{a.current&&(l.current&&clearTimeout(l.current),c(5),i(s("You have made too many requests")),l.current=setTimeout(()=>{if(!a.current){l.current=null;return}c(3),l.current=null},e*1e3))},[i,a,s]),k=r.useCallback(async()=>{try{const e=await T();if(!a.current)return;switch(e.result){case"auth":let u=[];e.devices.forEach(d=>u.push({id:d.device,name:d.display_name,methods:d.capabilities})),b(u),c(4);break;case"allow":i(s("Device selection was bypassed by Duo policy")),c(2);break;case"deny":i(s("Device selection was denied by Duo policy")),c(3);break;case"enroll":i(s("No compatible device found")),c(3);break}}catch(e){if(!a.current)return;console.error(e),i(s("There was an issue fetching Duo device(s)"))}},[i,a,s]),m=r.useCallback(async()=>{try{c(1);const e=await C();if(!a.current)return;if(e)if(e.data&&!e.limited)switch(e.data.result){case"auth":let u=[];e.data.devices.forEach(d=>u.push({id:d.device,name:d.display_name,methods:d.capabilities})),b(u),c(4);break;case"enroll":i(s("No compatible device found")),c(3);break;case"deny":i(s("Device selection was denied by Duo policy")),c(3);break;default:c(2),t.onSecondFactorSuccess();break}else e.limited?v(e.retryAfter):(i(s("There was an issue completing sign in process")),c(3));else i(s("There was an issue completing sign in process")),c(3)}catch(e){if(!a.current||o!==1)return;console.error(e),i(s("There was an issue completing sign in process")),c(3)}},[i,v,a,t,o,s]),D=r.useCallback(async function(e){try{await E(e),c(1)}catch(u){console.error(u),console.error(new Error(s("There was an issue updating preferred Duo device")))}},[s]),w=r.useCallback(e=>{D({device:e.id,method:e.method})},[D]);if(r.useEffect(()=>{o===1&&m()},[m,o]),o===4)return n.jsx(I,{devices:y,onBack:()=>c(1),onSelect:w});let f;switch(o){case 1:case 2:f=n.jsx(N,{width:64,height:64,animated:!0});break;case 3:f=n.jsx(j,{})}return n.jsxs(r.Fragment,{children:[n.jsxs(h,{className:p.container,children:[n.jsx(h,{className:p.icon,children:f}),n.jsx(h,{className:o!==3?"hidden":"",children:n.jsx(R,{color:"secondary",onClick:m,children:"Retry"})})]}),o!==2?n.jsx(h,{children:n.jsx(F,{component:"button",id:"selection-link",onClick:k,underline:"hover",children:s("Select a Device")})}):null]})},L=g()(t=>({container:{height:"120px"},icon:{width:"64px",height:"64px",display:"inline-block"}}));export{B as State,H as default};
