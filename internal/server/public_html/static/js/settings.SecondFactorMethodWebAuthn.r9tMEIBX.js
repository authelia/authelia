import{r as a,u as d,j as m}from"./index.Cnoc1xvA.js";import{W as S}from"./components.WebAuthnTryIcon.Ie24j3zY.js";import{u as w}from"./hooks.Mounted.zqJHXAmG.js";import{W as e,j as W,e as b,h as y,i as F,k as A}from"./services.WebAuthn.ssE5ERIK.js";import"./components.FailureIcon.CJF-1aOx.js";import"./components.SuccessIcon.DhmnFkmE.js";import"./components.TimerIcon.7hnoDN64.js";import"./constants.constants.C7XWv2Yg.js";import"./hooks.Timer.Cnyqth1t.js";import"./portal.IconWithContext.DucLu93y.js";import"./browserSupportsWebAuthn.Bhlk1eaM.js";const v=function(u){const[f,r]=a.useState(e.WaitTouch),[i,c]=a.useState(!1),t=w(),{t:s}=d(),h=()=>{r(e.WaitTouch),c(!1)},l=a.useCallback(async()=>{c(!0);try{const o=await W();if(o.status!==200||o.options==null){if(!t.current)return;r(e.Failure),console.error(new Error(s("Failed to initiate security key sign in process")));return}const n=await b(o.options);if(n.result!==y.Success){t.current&&(r(e.Failure),console.error(new Error(s(F(n.result)))));return}if(n.response==null){console.error(new Error(s("The browser did not respond with the expected attestation data"))),t.current&&r(e.Failure);return}if(!t.current)return;r(e.InProgress);const p=await A(n.response);if(p.data.status==="OK"&&p.status===200){if(!t.current)return;u.onSecondFactorSuccess();return}if(!t.current)return;console.error(new Error(s("The server rejected the security key"))),r(e.Failure)}catch(o){if(!t.current)return;console.error(o),r(e.Failure)}},[t,u,s]);return a.useEffect(()=>{i||l().catch(console.error)},[l,i]),m.jsx(S,{onRetryClick:h,webauthnTouchState:f})};export{v as default};
