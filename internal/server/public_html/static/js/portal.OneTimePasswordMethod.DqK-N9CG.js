import{u as b,g as D,h as j,r as t,A as u,j as m,B as A,L as k}from"./index.J4YSomth.js";import{j as U}from"./constants.constants.BvDkw1BZ.js";import{u as M}from"./hooks.OpenIDConnect.fHo8fPKW.js";import{a as _,S as r,O as B,b as H}from"./portal.OTPDial.B6MZu1xd.js";import{D as N,S}from"./portal.MethodContainer.B7LucbyW.js";import"./components.SuccessIcon.C3pLKly2.js";import"./components.TimerIcon.CO1b_Yfm.js";import"./portal.IconWithContext.CCYYopkv.js";import"./components.InformationIcon.Hu39YtA5.js";import"./portal.Authenticated.KMDfbGon.js";const X=function(e){const{t:n}=b(),L=D(j),{flow:R,id:y,subflow:I}=U(),C=M(),[c,v,,l]=_(),[d,O]=t.useState(""),F=t.useCallback((w,f)=>f.type,[]),[x,i]=t.useReducer(F,e.authenticationLevel===u.TwoFactor?r.Success:r.Idle),{onSignInError:g,onSignInSuccess:h}=e,s=t.useRef(g),T=t.useRef(h),o=t.useRef(null);t.useEffect(()=>{s.current=g},[g]),t.useEffect(()=>{T.current=h},[h]),t.useEffect(()=>()=>{o.current!==null&&(clearTimeout(o.current),o.current=null)},[]),t.useEffect(()=>{l&&(console.error(l),s.current(new Error(n("Could not obtain user settings"))),i({type:r.Failure}))},[s,l,n]),t.useEffect(()=>{e.registered&&e.authenticationLevel===u.OneFactor&&v()},[v,e.authenticationLevel,e.registered]);const P=t.useCallback(w=>{o.current&&clearTimeout(o.current),i({type:r.RateLimited}),s.current(new Error(n("You have made too many requests"))),o.current=setTimeout(()=>{i({type:r.Idle}),o.current=null},w*1e3)},[s,n]);t.useEffect(()=>{e.authenticationLevel>=u.TwoFactor&&i({type:r.Success})},[e.authenticationLevel]),t.useEffect(()=>{(async()=>{if(!e.registered||e.authenticationLevel===u.TwoFactor)return;const f=`${d}`;if(!(!d||f.length!==(c?.digits||6))){try{i({type:r.InProgress});const a=await H(f,L,y,R,I,C);a?a.limited?P(a.retryAfter):(i({type:r.Success}),T.current(a?.data?.redirect)):(s.current(new Error(n("The One-Time Password might be wrong"))),i({type:r.Failure}))}catch(a){console.error(a),s.current(new Error(n("The One-Time Password might be wrong"))),i({type:r.Failure})}O("")}})().catch(console.error)},[e.registered,e.authenticationLevel,d,c?.digits,L,y,R,I,C,s,n,T,P]);let E=S.METHOD;return e.authenticationLevel===u.TwoFactor?E=S.ALREADY_AUTHENTICATED:e.registered||(E=S.NOT_REGISTERED),m.jsx(N,{id:e.id,title:n("One-Time Password"),explanation:n("Enter One-Time Password"),duoSelfEnrollment:!1,registered:e.registered,state:E,onRegisterClick:e.onRegisterClick,children:m.jsx(A,{children:c!==void 0||l!==void 0?m.jsx(B,{passcode:d,period:c?.period||30,digits:c?.digits||6,onChange:O,state:x}):m.jsx(k,{})})})};export{X as default};
