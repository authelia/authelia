import{u as x,m as g,r as n,c as S,j as r,B as h}from"./index.DT4wSdGl.js";import{F as j}from"./components.FailureIcon.D820YZeh.js";import{P as N}from"./components.PushNotificationIcon.C3OKUcy2.js";import{u as P}from"./hooks.Mounted.hOcc0Tvd.js";import{i as T,c as C,a as E,D as I}from"./portal.DeviceSelectionContainer.Dx2atRi0.js";import{B as R,h as F}from"./constants.constants.BWko5Qp7.js";import"./components.SuccessIcon.XkZ9cS-G.js";var B=(i=>(i[i.SignInInProgress=1]="SignInInProgress",i[i.Success=2]="Success",i[i.Failure=3]="Failure",i[i.Selection=4]="Selection",i[i.RateLimited=5]="RateLimited",i))(B||{});const H=function(i){const{t:s}=x("portal"),{classes:p}=L(),[a,c]=n.useState(1),u=P(),[y,b]=n.useState([]),{createErrorNotification:t}=S(),d=n.useRef(null);n.useEffect(()=>{if(d.current!==null)return clearTimeout(d.current)},[]);const v=n.useCallback(e=>{d.current&&clearTimeout(d.current),c(5),t(s("You have made too many requests")),d.current=setTimeout(()=>{c(3),d.current=null},e*1e3)},[t,s]),k=n.useCallback(async()=>{try{const e=await T();if(!u.current)return;switch(e.result){case"auth":let o=[];e.devices.forEach(l=>o.push({id:l.device,name:l.display_name,methods:l.capabilities})),b(o),c(4);break;case"allow":t(s("Device selection was bypassed by Duo policy")),c(2);break;case"deny":t(s("Device selection was denied by Duo policy")),c(3);break;case"enroll":t(s("No compatible device found")),c(3);break}}catch(e){if(!u.current)return;console.error(e),t(s("There was an issue fetching Duo device(s)"))}},[t,u,s]),m=n.useCallback(async()=>{try{c(1);const e=await C();if(!u.current)return;if(e)if(e.data&&!e.limited)switch(e.data.result){case"auth":let o=[];e.data.devices.forEach(l=>o.push({id:l.device,name:l.display_name,methods:l.capabilities})),b(o),c(4);break;case"enroll":t(s("No compatible device found")),c(3);break;case"deny":t(s("Device selection was denied by Duo policy")),c(3);break;default:c(2),i.onSecondFactorSuccess();break}else e.limited?v(e.retryAfter):(t(s("There was an issue completing sign in process")),c(3));else t(s("There was an issue completing sign in process")),c(3)}catch(e){if(!u.current||a!==1)return;console.error(e),t(s("There was an issue completing sign in process")),c(3)}},[t,v,u,i,a,s]),D=n.useCallback(async function(e){try{await E(e),c(1)}catch(o){console.error(o),console.error(new Error(s("There was an issue updating preferred Duo device")))}},[s]),w=n.useCallback(e=>{D({device:e.id,method:e.method})},[D]);if(n.useEffect(()=>{a===1&&m()},[m,a]),a===4)return r.jsx(I,{devices:y,onBack:()=>c(1),onSelect:w});let f;switch(a){case 1:case 2:f=r.jsx(N,{width:64,height:64,animated:!0});break;case 3:f=r.jsx(j,{})}return r.jsxs(n.Fragment,{children:[r.jsxs(h,{className:p.container,children:[r.jsx(h,{className:p.icon,children:f}),r.jsx(h,{className:a!==3?"hidden":"",children:r.jsx(R,{color:"secondary",onClick:m,children:"Retry"})})]}),a!==2?r.jsx(h,{children:r.jsx(F,{component:"button",id:"selection-link",onClick:k,underline:"hover",children:s("Select a Device")})}):null]})},L=g()(i=>({container:{height:"120px"},icon:{width:"64px",height:"64px",display:"inline-block"}}));export{B as State,H as default};
