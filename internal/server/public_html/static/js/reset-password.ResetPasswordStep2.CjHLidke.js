import{u as I,m as z,r,c as W,p as A,g as B,s as F,j as t,G as l,t as K,I as C}from"./index.J4YSomth.js";import{P as k,a as L,g as V}from"./services.PasswordPolicyConfiguration.D-_mZ7gP.js";import{M as G}from"./layouts.Minimal.B5R3q08x.js";import{c as U,r as Y}from"./reset-password.ResetPassword.jbPnUGnP.js";import{F as O,T as S}from"./mui.TextField.oVnBvIhZ.js";import{I as Q,V as H,a as J}from"./mui.VisibilityOff.BbFGBtcl.js";import{B as T}from"./constants.constants.BvDkw1BZ.js";import"./components.TypographyWithTooltip.DDFBjLT9.js";const ie=function(){const{t:s}=I(),{classes:n,cx:w}=X(),[p,c]=r.useState(!0),[i,h]=r.useState(""),[d,x]=r.useState(""),[D,y]=r.useState(!1),[N,g]=r.useState(!1),{createErrorNotification:o,createSuccessNotification:R}=W(),P=A(),[m,a]=r.useState(!1),[b,E]=r.useState({max_length:0,min_length:8,min_score:0,mode:k.Disabled,require_lowercase:!1,require_number:!1,require_special:!1,require_uppercase:!1}),f=B(F),v=r.useCallback(e=>{o(s("You have made too many requests"))},[o,s]);r.useEffect(()=>{(async()=>{if(!f){c(!0),o(s("No verification token provided"));return}try{const u=await U(f);if(u?.limited){v(u.retryAfter);return}const q=await V();E(q),c(!1)}catch(u){console.error(u),o(s("There was an issue completing the process the verification token might have expired")),c(!0)}})().catch(console.error)},[f,o,s,v]);const j=async()=>{if(h(""),x(""),i===""||d===""){i===""&&y(!0),d===""&&g(!0);return}if(i!==d){y(!0),g(!0),o(s("Passwords do not match"));return}c(!0);try{await Y(i),R(s("Password has been reset")),setTimeout(()=>P(C),1500)}catch(e){console.error(e),e.message.includes("0000052D.")||e.message.includes("policy")?o(s("Your supplied password does not meet the password policy requirements")):o(s("There was an issue resetting the password"))}},_=()=>{j().catch(console.error)},M=()=>P(C);return t.jsx(G,{title:s("Enter new password"),id:"reset-password-step2-stage",children:t.jsx(O,{id:"form-reset-password",children:t.jsxs(l,{container:!0,className:n.root,spacing:2,children:[t.jsxs(l,{size:{xs:12},children:[t.jsx(S,{id:"password1-textfield",label:s("New password"),variant:"outlined",type:m?"text":"password",value:i,disabled:p,onChange:e=>h(e.target.value),error:D,className:w(n.fullWidth),autoComplete:"new-password",slotProps:{input:{endAdornment:t.jsx(Q,{position:"end",children:t.jsx(K,{"aria-label":"toggle password visibility",edge:"end",size:"large",onMouseDown:()=>a(!0),onMouseUp:()=>a(!1),onMouseLeave:()=>a(!1),onTouchStart:()=>a(!0),onTouchEnd:()=>a(!1),onTouchCancel:()=>a(!1),onKeyDown:e=>{e.key===" "&&(a(!0),e.preventDefault())},onKeyUp:e=>{e.key===" "&&(a(!1),e.preventDefault())},children:m?t.jsx(H,{}):t.jsx(J,{})})})}}}),b.mode===k.Disabled?null:t.jsx(L,{value:i,policy:b})]}),t.jsx(l,{size:{xs:12},children:t.jsx(S,{id:"password2-textfield",label:s("Repeat new password"),variant:"outlined",type:m?"text":"password",disabled:p,value:d,onChange:e=>x(e.target.value),error:N,onKeyDown:e=>{e.key==="Enter"&&(j().catch(console.error),e.preventDefault())},className:w(n.fullWidth),autoComplete:"new-password"})}),t.jsx(l,{size:{xs:6},children:t.jsx(T,{id:"reset-button",variant:"contained",color:"primary",name:"password1",disabled:p,onClick:_,className:n.fullWidth,children:s("Reset")})}),t.jsx(l,{size:{xs:6},children:t.jsx(T,{id:"cancel-button",variant:"contained",color:"primary",name:"password2",onClick:M,className:n.fullWidth,children:s("Cancel")})})]})})})},X=z()(s=>({fullWidth:{width:"100%"},root:{marginBottom:s.spacing(2),marginTop:s.spacing(2)}}));export{ie as default};
