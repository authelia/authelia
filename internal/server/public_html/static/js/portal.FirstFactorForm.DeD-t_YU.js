import{j as t,u as W,g as A,h as K,am as B,r as n,G as u,T as se,m as ne,p as re,c as oe,an as ae}from"./index.CEiXDjRd.js";import{I as ie,V as le,a as ce,A as ue,b as de}from"./mui.VisibilityOff.CN4DP5jp.js";import{S as fe,v as N,k as he,B as O,C as Z,I as me,t as we}from"./constants.constants.RkJrtp09.js";import{u as ge}from"./hooks.OpenIDConnect.BHe-4a9-.js";import{L as xe}from"./layouts.Login.CjPCW2LZ.js";import{p as pe,I as be}from"./services.Password.Dab8ZkAz.js";import{u as ye}from"./hooks.Mounted.Bd30MWyg.js";import{c as Ce,e as ke,h as Se,i as je,p as ve}from"./services.WebAuthn.CccHG5Sl.js";import{B as Re,C as Me}from"./broadcast-channel.BRh3EaRr.js";import{F as Le,T as U}from"./mui.TextField.o9feOhtZ.js";import{F as Te}from"./mui.FormControlLabel.DQvGqv1W.js";import"./components.TypographyWithTooltip.7-AVamcY.js";import"./browserSupportsWebAuthn.Bhlk1eaM.js";const Ae=function(){return t.jsx(fe,{children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:24,width:24,viewBox:"0 -960 960 960",fill:"#e8eaed",children:t.jsx("path",{d:"M120-160v-112q0-34 17.5-62.5T184-378q62-31 126-46.5T440-440q20 0 40 1.5t40 4.5q-4 58 21 109.5t73 84.5v80H120ZM760-40l-60-60v-186q-44-13-72-49.5T600-420q0-58 41-99t99-41q58 0 99 41t41 99q0 45-25.5 80T790-290l50 50-60 60 60 60-80 80ZM440-480q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm300 80q17 0 28.5-11.5T780-440q0-17-11.5-28.5T740-480q-17 0-28.5 11.5T700-440q0 17 11.5 28.5T740-400Z"})})})},Pe=function(e){const{t:r}=W(),d=A(K),k=A(B),{flow:v,id:x,subflow:S}=N(),l=ye(),[p,j]=n.useState(!1),c=n.useRef(e.onAuthenticationError).current,b=n.useCallback(()=>{e.onAuthenticationStart(),j(!0)},[e]),i=n.useCallback(()=>{e.onAuthenticationStop(),j(!1)},[e]),y=n.useCallback(async()=>{if(!(!l||p)){b();try{const m=await Ce();if(m.status!==200||m.options==null){i(),c(new Error(r("Failed to initiate security key sign in process")));return}const o=await ke(m.options);if(o.result!==Se.Success){if(!l.current)return;i(),c(new Error(r(je(o.result))));return}if(o.response==null){c(new Error(r("The browser did not respond with the expected attestation data"))),i();return}if(!l.current)return;const w=await ve(o.response,e.rememberMe,d,k,x,v,S);if(i(),w.data.status==="OK"&&w.status===200){e.onAuthenticationSuccess(w.data.data?w.data.data.redirect:void 0);return}if(!l.current)return;c(new Error(r("The server rejected the security key")))}catch(m){if(i(),!l.current)return;console.error(m),c(new Error(r("Failed to initiate security key sign in process")))}}},[l,p,b,e,d,k,x,v,S,i,c,r]);return t.jsxs(n.Fragment,{children:[t.jsx(u,{size:{xs:12},children:t.jsx(he,{component:"div",children:t.jsx(se,{sx:{textTransform:"uppercase"},children:r("or")})})}),t.jsx(u,{size:{xs:12},children:t.jsx(O,{id:"passkey-sign-in-button",variant:"contained",color:"primary",fullWidth:!0,onClick:y,startIcon:t.jsx(Ae,{}),disabled:e.disabled,endIcon:p?t.jsx(Z,{size:20}):null,children:r("Sign in with a passkey")})})]})},Ve=function(e){const{t:r}=W(),{classes:d,cx:k}=Ee(),v=re(),x=A(K),S=A(B),{flow:l,id:p,subflow:j}=N(),c=ge(),{createErrorNotification:b}=oe(),i=n.useMemo(()=>new Re("login"),[]),[y,m]=n.useState(!1),[o,w]=n.useState(""),[G,R]=n.useState(!1),[a,P]=n.useState(""),[I,f]=n.useState(!1),[V,q]=n.useState(!1),[H,F]=n.useState(!1),[Q,z]=n.useState(!1),[X,E]=n.useState(!1),M=n.useRef(null),L=n.useRef(null),C=n.useCallback(()=>{M.current!==null&&M.current.focus()},[M]),h=n.useCallback(()=>{L.current!==null&&L.current.focus()},[L]);n.useEffect(()=>{const s=setTimeout(()=>C(),10);return()=>clearTimeout(s)},[C]),n.useEffect(()=>{i.addEventListener("message",s=>{s&&e.onChannelStateChange()})},[i,x,e]);const T=e.disabled,J=()=>{m(!y)},g=n.useCallback(async()=>{if(o===""||a===""){o===""&&R(!0),a===""&&z(!0);return}E(!0),e.onAuthenticationStart();try{const s=await pe(o,a,y,x,S,p,l,j,c);E(!1),await i.postMessage(!0),e.onAuthenticationSuccess(s?s.redirect:void 0)}catch(s){console.error(s),b(r("Incorrect username or password")),E(!1),e.onAuthenticationStop(),P(""),h()}},[o,a,e,y,x,S,p,l,j,c,i,b,r,h]),Y=()=>{e.resetPassword&&(e.resetPasswordCustomURL?window.open(e.resetPasswordCustomURL):v(ae))},_=n.useCallback(s=>{s.key==="Enter"&&(o.length?o.length&&a.length?g().catch(console.error):(R(!1),h()):R(!0))},[h,g,a.length,o.length]),$=n.useCallback(s=>{s.key==="Enter"&&(o.length?a.length||h():C(),g().catch(console.error),s.preventDefault())},[h,C,g,a.length,o.length]),ee=n.useCallback(s=>{if(a.length<=1&&(q(!1),F(!1),a.length===0))return;const D=be(s);D!==null&&(D?q(!0):F(!0))},[a.length]),te=n.useCallback(s=>{s.key==="Enter"&&(o.length?a.length||h():C(),g().catch(console.error))},[h,C,g,a.length,o.length]);return t.jsx(xe,{id:"first-factor-stage",title:r("Sign in"),children:t.jsx(Le,{id:"form-login",children:t.jsxs(u,{container:!0,spacing:2,children:[t.jsx(u,{size:{xs:12},children:t.jsx(U,{inputRef:M,id:"username-textfield",label:r("Username"),variant:"outlined",required:!0,value:o,error:G,disabled:T,fullWidth:!0,onChange:s=>w(s.target.value),onFocus:()=>R(!1),autoCapitalize:"none",autoComplete:"username",onKeyDown:_,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",transition:"all 0.3s ease-in-out","&:hover fieldset":{borderColor:"primary.main"},"&.Mui-focused fieldset":{borderWidth:"2px"}},"& .MuiInputLabel-root":{fontSize:"0.95rem"}}})}),t.jsx(u,{size:{xs:12},children:t.jsx(U,{inputRef:L,id:"password-textfield",label:r("Password"),variant:"outlined",required:!0,fullWidth:!0,disabled:T,value:a,error:Q,onChange:s=>P(s.target.value),onFocus:()=>z(!1),type:I?"text":"password",autoComplete:"current-password",onKeyDown:$,onKeyUp:ee,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",transition:"all 0.3s ease-in-out","&:hover fieldset":{borderColor:"primary.main"},"&.Mui-focused fieldset":{borderWidth:"2px"}},"& .MuiInputLabel-root":{fontSize:"0.95rem"}},slotProps:{input:{endAdornment:t.jsx(ie,{position:"end",children:t.jsx(me,{"aria-label":"toggle password visibility",edge:"end",size:"large",onMouseDown:()=>f(!0),onMouseUp:()=>f(!1),onMouseLeave:()=>f(!1),onTouchStart:()=>f(!0),onTouchEnd:()=>f(!1),onTouchCancel:()=>f(!1),onKeyDown:s=>{s.key===" "&&(f(!0),s.preventDefault())},onKeyUp:s=>{s.key===" "&&(f(!1),s.preventDefault())},children:I?t.jsx(le,{}):t.jsx(ce,{})})})}}})}),V?t.jsx(u,{size:{xs:12},marginX:2,children:t.jsxs(ue,{severity:"warning",children:[t.jsx(de,{children:r("Warning")}),r(H?"The password was partially entered with Caps Lock":"The password was entered with Caps Lock")]})}):null,e.rememberMe?t.jsx(u,{size:{xs:12},className:k(d.actionRow),children:t.jsx(Te,{control:t.jsx(Me,{id:"remember-checkbox",disabled:T,checked:y,onChange:J,onKeyDown:te,value:"rememberMe",color:"primary"}),className:d.rememberMe,label:r("Remember me")})}):null,t.jsx(u,{size:{xs:12},children:t.jsx(O,{id:"sign-in-button",variant:"contained",color:"primary",fullWidth:!0,endIcon:X?t.jsx(Z,{size:20,color:"inherit"}):null,disabled:T,onClick:g,sx:{height:"48px",borderRadius:"8px",fontSize:"1rem",fontWeight:600,textTransform:"none",boxShadow:"none",transition:"background-color 0.2s ease-in-out","&:hover":{boxShadow:"none",backgroundColor:"#238a9f"}},children:r("Sign in to continue")})}),e.passkeyLogin?t.jsx(Pe,{disabled:e.disabled,rememberMe:e.rememberMe,onAuthenticationError:s=>b(s.message),onAuthenticationStart:()=>{w(""),P(""),e.onAuthenticationStart()},onAuthenticationStop:e.onAuthenticationStop,onAuthenticationSuccess:e.onAuthenticationSuccess}):null,e.resetPassword?t.jsx(u,{size:{xs:12},className:k(d.actionRow,d.flexEnd),children:t.jsx(we,{id:"reset-password-button",component:"button",onClick:Y,className:d.resetLink,underline:"hover",children:r("Reset password?")})}):null]})})})},Ee=ne()(e=>({actionRow:{display:"flex",flexDirection:"row",marginBottom:e.spacing(1),marginTop:e.spacing(1)},flexEnd:{justifyContent:"flex-end"},rememberMe:{flexGrow:1,"& .MuiFormControlLabel-label":{fontSize:"0.9rem",color:e.palette.text.secondary}},resetLink:{cursor:"pointer",paddingBottom:13.5,paddingTop:13.5,fontSize:"0.9rem",fontWeight:600,color:e.palette.primary.main,transition:"all 0.2s ease-in-out","&:hover":{color:e.palette.primary.dark,textDecoration:"none"}}}));export{Ve as default};
