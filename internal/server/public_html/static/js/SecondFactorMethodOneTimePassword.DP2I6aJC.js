import{u as T,r as e,c as S,j as f,L as E}from"./index.B4PwAJYr.js";import{S as t,a as P,b as x,O as C}from"./OTPDial.CTfxwKKM.js";import"./SuccessIcon.DECb_tfH.js";import"./TimerIcon._wOedlIX.js";import"./constants.BRYNkPs0.js";import"./IconWithContext.uVFIwzaz.js";const w=function(I){const{t:n}=T(["settings","portal"]),[i,m]=e.useState(""),[h,r]=e.useState(t.Idle),{createErrorNotification:c}=S(),[s,d,,u]=P(),o=e.useRef(null);e.useEffect(()=>{if(o.current!==null)return clearTimeout(o.current)},[]),e.useEffect(()=>{u&&(console.error(u),r(t.Failure))},[u,n]),e.useEffect(()=>{d()},[d]);const p=e.useCallback(l=>{o.current&&clearTimeout(o.current),r(t.RateLimited),c(n("You have made too many requests",{ns:"portal"})),o.current=setTimeout(()=>{r(t.Idle),o.current=null},l*1e3)},[c,n]),g=e.useCallback(async()=>{const l=`${i}`;if(s&&!(!i||l.length!==s.digits)){try{r(t.InProgress);const a=await x(l);a?a.limited?p(a.retryAfter):r(t.Success):(c(n("The One-Time Password might be wrong",{ns:"portal"})),r(t.Failure))}catch(a){console.error(a),r(t.Failure)}m("")}},[i,s,p,c,n]);return e.useEffect(()=>{g().catch(console.error)},[g]),f.jsx(e.Fragment,{children:s&&!u?f.jsx(C,{passcode:i,period:s.period,digits:s.digits,onChange:m,state:h}):f.jsx(E,{})})};export{w as default};
