import{u as b,g as D,h as j,r as t,A as u,j as m,B as A,L as k}from"./index.aN1zXoDM.js";import{j as y}from"./constants.constants.BnGwwtlq.js";import{u as U}from"./hooks.OpenIDConnect.ByE4cm2n.js";import{a as M,S as r,b as B,O as H}from"./portal.OTPDial.FYh3_uke.js";import{D as N,S as h}from"./portal.MethodContainer.Bnj_0SjL.js";import"./components.SuccessIcon.C7yq4zu8.js";import"./components.TimerIcon.BDnG6Rge.js";import"./portal.IconWithContext.VrE4wYXs.js";import"./components.InformationIcon.CVryNOl2.js";import"./portal.Authenticated.BorPWeDY.js";const W=function(e){const{t:n}=b(),T=D(j),{id:E,flow:S,subflow:w}=y(),L=U(),[c,R,,l]=M(),[d,v]=t.useState(""),[P,i]=t.useState(e.authenticationLevel===u.TwoFactor?r.Success:r.Idle),{onSignInSuccess:x,onSignInError:F}=e,o=t.useRef(F).current,C=t.useRef(x).current,a=t.useRef(null);t.useEffect(()=>{if(a.current!==null)return clearTimeout(a.current)},[]),t.useEffect(()=>{l&&(console.error(l),o(new Error(n("Could not obtain user settings"))),i(r.Failure))},[o,l,n]),t.useEffect(()=>{e.registered&&e.authenticationLevel===u.OneFactor&&R()},[R,e.authenticationLevel,e.registered]);const I=t.useCallback(f=>{a.current&&clearTimeout(a.current),i(r.RateLimited),o(new Error(n("You have made too many requests"))),a.current=setTimeout(()=>{i(r.Idle),a.current=null},f*1e3)},[o,n]),O=t.useCallback(async()=>{if(!e.registered||e.authenticationLevel===u.TwoFactor)return;const f=`${d}`;if(!(!d||f.length!==(c?.digits||6))){try{i(r.InProgress);const s=await B(f,T,E,S,w,L);s?s.limited?I(s.retryAfter):(i(r.Success),C(s&&s.data?s.data.redirect:void 0)):(o(new Error(n("The One-Time Password might be wrong"))),i(r.Failure))}catch(s){console.error(s),o(new Error(n("The One-Time Password might be wrong"))),i(r.Failure)}v("")}},[e.registered,e.authenticationLevel,d,c?.digits,T,E,S,w,L,o,n,C,I]);t.useEffect(()=>{e.authenticationLevel>=u.TwoFactor&&i(r.Success)},[e.authenticationLevel,i]),t.useEffect(()=>{O().catch(console.error)},[O]);let g=h.METHOD;return e.authenticationLevel===u.TwoFactor?g=h.ALREADY_AUTHENTICATED:e.registered||(g=h.NOT_REGISTERED),m.jsx(N,{id:e.id,title:n("One-Time Password"),explanation:n("Enter One-Time Password"),duoSelfEnrollment:!1,registered:e.registered,state:g,onRegisterClick:e.onRegisterClick,children:m.jsx(A,{children:c!==void 0||l!==void 0?m.jsx(H,{passcode:d,period:c?.period||30,digits:c?.digits||6,onChange:v,state:P}):m.jsx(k,{})})})};export{W as default};
