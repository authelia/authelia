import{r as a,u as d,j as m}from"./index.ChPl_EQa.js";import{W as S}from"./WebAuthnTryIcon.xUbCgyOi.js";import{u as w}from"./Mounted.BDD2csTQ.js";import{W as t,j as W,e as b,h as y,i as F,k as A}from"./WebAuthn.Bl8o_9tA.js";import"./FailureIcon.CxGqcw_S.js";import"./SuccessIcon.B9a1SrTu.js";import"./TimerIcon.B7oHXPOi.js";import"./constants.BMlb_xNc.js";import"./Timer.R1JhW7SA.js";import"./IconWithContext.De5e-2-q.js";import"./browserSupportsWebAuthn.Bhlk1eaM.js";const v=function(u){const[p,e]=a.useState(t.WaitTouch),[i,h]=a.useState(!1),r=w(),{t:s}=d(),f=()=>{e(t.WaitTouch)},c=a.useCallback(async()=>{h(!0);try{const o=await W();if(o.status!==200||o.options==null){e(t.Failure),console.error(new Error(s("Failed to initiate security key sign in process")));return}const n=await b(o.options);if(n.result!==y.Success){if(!r.current)return;e(t.Failure),console.error(new Error(s(F(n.result))));return}if(n.response==null){console.error(new Error(s("The browser did not respond with the expected attestation data"))),e(t.Failure);return}if(!r.current)return;e(t.InProgress);const l=await A(n.response);if(l.data.status==="OK"&&l.status===200){u.onSecondFactorSuccess();return}if(!r.current)return;console.error(new Error(s("The server rejected the security key"))),e(t.Failure)}catch(o){if(!r.current)return;console.error(o),e(t.Failure)}},[r,u,s]);return a.useEffect(()=>{i||c().catch(console.error)},[c,i]),m.jsx(S,{onRetryClick:f,webauthnTouchState:p})};export{v as default};
