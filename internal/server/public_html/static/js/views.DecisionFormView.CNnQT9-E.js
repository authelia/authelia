import{M as x,j as e,bm as re,bn as oe,an as ze,bo as T,bp as ae,a4 as Pe,bq as De,u as k,m as A,r,G as u,B as S,o as Ie,c as Fe,k as Re,i as Te,A as Ue,I,br as G,bs as W,bt as Y,aN as X,bu as J,e as Q,T as Me,t as Ee,ak as Ne,q as Z,L as qe}from"./index.t7Hp6wWA.js";import{L as Be}from"./components.LogoutButton.C0OCJm2t.js";import{S as Ve}from"./components.SwitchUserButton.DDv7xt1b.js";import{b as ie,T as C,e as $e,f as He,j as Oe,B as ee}from"./constants.constants.D9Jh23gv.js";import{u as Ke}from"./hooks.OpenIDConnect.RqyKR777.js";import{L as Ge}from"./layouts.Login.DLs9S7Cd.js";import{b as We,I as Ye}from"./services.Password.DB-Dxij9.js";import{F}from"./mui.FormControlLabel.oDEBs5nP.js";import{C as R,B as Xe}from"./broadcast-channel.avbFvJ_N.js";import{L as Je}from"./mui.ListItem.8sjJs4UP.js";import{F as Qe,T as Ze}from"./mui.TextField.BMu1N8UI.js";import{I as es,V as ss,a as ts,A as ns}from"./mui.VisibilityOff.C0Vodw9A.js";import"./layouts.usePortalStyles.CQncL4s1.js";const rs=x(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6m7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58z"})),os=x(e.jsx("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6m6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26"})),as=x(e.jsx("path",{d:"M20 0H4v2h16zM4 24h16v-2H4zM20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m-8 2.75c1.24 0 2.25 1.01 2.25 2.25s-1.01 2.25-2.25 2.25S9.75 10.24 9.75 9 10.76 6.75 12 6.75M17 17H7v-1.5c0-1.67 3.33-2.5 5-2.5s5 .83 5 2.5z"})),is=x(e.jsx("path",{d:"M21.99 8c0-.72-.37-1.35-.94-1.7L12 1 2.95 6.3C2.38 6.65 2 7.28 2 8v10c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2zM12 13 3.74 7.84 12 3l8.26 4.84z"})),cs=x(e.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"})),ls=x(e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})),us=x(e.jsx("path",{d:"M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m6-9h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h1.9c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m0 12H6V10h12z"})),ds=x(e.jsx("path",{d:"M16 1H8C6.34 1 5 2.34 5 4v16c0 1.66 1.34 3 3 3h8c1.66 0 3-1.34 3-3V4c0-1.66-1.34-3-3-3m-2 20h-4v-1h4zm3.25-3H6.75V4h10.5z"})),hs=x([e.jsx("path",{d:"m21 5-9-4-9 4v6c0 5.55 3.84 10.74 9 12 2.3-.56 4.33-1.9 5.88-3.71l-3.12-3.12c-1.94 1.29-4.58 1.07-6.29-.64-1.95-1.95-1.95-5.12 0-7.07s5.12-1.95 7.07 0c1.71 1.71 1.92 4.35.64 6.29l2.9 2.9C20.29 15.69 21 13.38 21 11z"},"0"),e.jsx("circle",{cx:"12",cy:"12",r:"3"},"1")]),ce="openid",le="offline_access",ue="profile",de="groups",he="email",fe="phone",pe="address",me="authelia.bearer.authz";function fs(s){switch(s){case ce:return e.jsx(rs,{});case le:return e.jsx(os,{});case ue:return e.jsx(as,{});case de:return e.jsx(cs,{});case he:return e.jsx(is,{});case fe:return e.jsx(ds,{});case pe:return e.jsx(ls,{});case me:return e.jsx(us,{});default:return e.jsx(hs,{})}}function ps(s){switch(s){case ce:return"Use OpenID to verify your identity";case le:return"Automatically refresh these permissions without user interaction";case ue:return"Access your profile information";case de:return"Access your group membership";case he:return"Access your email addresses";case fe:return"Access your phone number";case pe:return"Access your address";case me:return"Access protected resources logged in as you";default:return s}}function se(s,t){const a=new URLSearchParams;return s&&a.append(re,s),t&&a.append(oe,t),ze(`${T}?${a.toString()}`)}function ms(s,t,a,i,h,w){return ae(T,{flow_id:i,client_id:t,consent:!0,pre_configure:s,claims:a,subflow:h,user_code:w})}function gs(s,t){const a=new URLSearchParams;return a.append(re,s),a.append(oe,t),Pe.put(De,a)}function xs(s,t,a,i){return ae(T,{flow_id:t,client_id:s,consent:!1,pre_configure:!1,subflow:a,user_code:i})}function js(s,t){return!s.startsWith("scopes.")&&s!==""?s:ps(t)}function te(s,t){return!s.startsWith("claims.")&&s!==""?s:Cs(t)}function Cs(s){switch(s){case"name":return"Display Name";case"sub":return"Unique Identifier";case"zoneinfo":return"Timezone";case"locale":return"Locale / Language";case"updated_at":return"Information Updated Time";case"profile":case"website":case"picture":return`${ne(s)} URL`;default:return ne(s)}}function ne(s){s=(s.charAt(0).toUpperCase()+s.slice(1)).replace("_verified"," (Verified)").replace("_"," ");for(let t=0;t<s.length;t++){const a=t+1;s[t]===" "&&a<s.length&&s.charAt(a).toUpperCase()}return s}const ws=s=>{const{t}=k(["consent"]),{classes:a}=bs(),[i,h]=r.useState([]),w=o=>{h(m=>m.includes(o.target.value)?m.filter(p=>p!==o.target.value):[...m,o.target.value])};r.useEffect(()=>{s.claims&&h(s.claims)},[s.claims]),r.useEffect(()=>{s.onChangeChecked(i)},[i,s]);const f=r.useCallback(o=>i.includes(o),[i]),v=s?.essential_claims||s?.claims;return e.jsx(r.Fragment,{children:v?e.jsx(u,{size:{xs:12},children:e.jsx(S,{className:a.container,children:e.jsxs(ie,{className:a.list,children:[s.essential_claims?.map(o=>e.jsx(C,{title:t("Claim",{name:o}),children:e.jsx(F,{control:e.jsx(R,{id:`claim-${o}-essential`,disabled:!0,checked:!0}),label:te(t(`claims.${o}`),o)})},`${o}-essential`)),s.claims?.map(o=>e.jsx(C,{title:t("Claim",{name:o}),children:e.jsx(F,{control:e.jsx(R,{id:"claim-"+o,value:o,checked:f(o),onChange:w}),label:te(t(`claims.${o}`),o)})},o))]})})}):null})},bs=A()(s=>({container:{textAlign:"center"},list:{display:"inline-block",backgroundColor:s.palette.background.paper,marginTop:s.spacing(2),marginBottom:s.spacing(2)}})),ys=s=>{const{t}=k(["consent"]),{classes:a}=vs(),[i,h]=r.useState(!1),w=()=>{h(f=>!f)};return r.useEffect(()=>{s.onChangePreConfiguration(i)},[i,s]),e.jsx(r.Fragment,{children:s.pre_configuration?e.jsx(u,{size:{xs:12},children:e.jsx(C,{title:t("This saves this consent as a pre-configured consent for future use"),children:e.jsx(F,{control:e.jsx(R,{id:"pre-configure",checked:i,onChange:w,value:"preConfigure",color:"primary"}),className:a.preConfigure,label:t("Remember Consent")})})}):null})},vs=A()(s=>({preConfigure:{}})),Ss=s=>{const{t}=k(["consent"]),{classes:a}=Ls();return e.jsx(u,{size:{xs:12},children:e.jsx(S,{className:a.scopesListContainer,children:e.jsx(ie,{className:a.scopesList,children:s.scopes.map(i=>e.jsx(C,{title:t("Scope",{name:i}),children:e.jsxs(Je,{id:"scope-"+i,dense:!0,children:[e.jsx($e,{children:fs(i)}),e.jsx(He,{primary:js(t(`scopes.${i}`),i)})]},i)},i))})})})},Ls=A()(s=>({scopesListContainer:{textAlign:"center"},scopesList:{display:"inline-block",backgroundColor:s.palette.background.paper,marginTop:s.spacing(2),marginBottom:s.spacing(2)}})),qs=s=>{const{t}=k(["consent","portal"]),a=Ie(),{classes:i}=_s(),{createErrorNotification:h,resetNotification:w}=Fe(),f=Re(),v=Te(),{id:o,flow:m,subflow:l}=Oe(),p=Ke(),[g,U]=r.useState(""),[ge,M]=r.useState(!1),[xe,E]=r.useState(!1),[z,y]=r.useState(!1),[je,L]=r.useState(!1),[Ce,N]=r.useState(!1),[we,q]=r.useState(!1),[B,j]=r.useState(!1),[c,V]=r.useState(),[P,be]=r.useState(void 0),[$,ye]=r.useState([]),[H,ve]=r.useState(!1),O=r.useMemo(()=>new Xe("login"),[]),_=r.useRef(null),Se=n=>{ve(n)};r.useEffect(()=>{s.state.authentication_level===Ue.Unauthenticated?f(I):o||p?se(o,p).then(n=>{V(n)}).catch(n=>{be(n)}):f(I)},[o,f,s.state.authentication_level,p]),r.useEffect(()=>{P&&(f(I),console.error(`Unable to display consent screen: ${P.message}`))},[f,w,h,P]);const b=r.useCallback(()=>{_.current!==null&&_.current.focus()},[_]),D=r.useCallback(async()=>{if(!c)return;if(c.require_login){if(g.length===0){q(!0),b();return}y(!0),L(!0);try{await We(g,void 0,void 0,o,m,l,p),await O.postMessage(!0)}catch(Ae){console.error(Ae),h(t("Failed to confirm your identity",{ns:"portal"})),U(""),y(!1),L(!1),b();return}const d=await se(o,p);if(V(d),d.require_login){h(t("Failed to confirm your identity",{ns:"portal"}));return}}else y(!0),L(!0);const n=await ms(H,c.client_id,$,o,l,p);if(y(!1),L(!1),(!l||l==="")&&n.redirect_uri)v(n.redirect_uri);else if(l&&l===G)if(n.flow_id&&p){await gs(n.flow_id,p);const d=new URLSearchParams;m&&d.set(W,m),l&&d.set(Y,l),d.set(X,"accepted"),f(J+Q,!1,!1,!1,d)}else throw h(t("Failed to submit the user code")),new Error("Failed to perform user code submission");else throw h(t("Failed to redirect you",{ns:"portal"})),new Error("Unable to redirect the user")},[$,h,m,o,b,O,f,g,H,v,c,l,t,p]),Le=async()=>{if(!c)return;y(!0),N(!0);const n=await xs(c.client_id,o,l,p);if(y(!1),N(!1),(!l||l==="")&&n.redirect_uri)v(n.redirect_uri);else if(l&&l===G){const d=new URLSearchParams;m&&d.set(W,m),l&&d.set(Y,l),d.set(X,"rejected"),f(J+Q,!1,!1,!1,d)}else throw new Error("Unable to redirect the user")};r.useEffect(()=>{const n=setTimeout(()=>b(),10);return()=>clearTimeout(n)},[b]);const _e=r.useCallback(n=>{n.key==="Enter"&&(n.preventDefault(),g.length?D().catch(console.error):b())},[b,D,g.length]),ke=r.useCallback(n=>{if(g.length<=1&&(M(!1),E(!1),g.length===0))return;const d=Ye(n);d!==null&&(d?M(!0):E(!0))},[g.length]),K=c?.require_login&&g.length===0;return e.jsx(r.Fragment,{children:s.userInfo&&c!==void 0?e.jsx(Ge,{id:"openid-consent-decision-stage",title:`${t("Hi",{ns:"portal"})} ${s.userInfo.display_name}`,subtitle:t("Consent Request"),children:e.jsxs(u,{container:!0,direction:"column",justifyContent:"center",alignItems:"center",children:[e.jsxs(u,{size:{xs:12},sx:{paddingBottom:a.spacing(2)},children:[e.jsx(Be,{})," "," | "," ",e.jsx(Ve,{})]}),e.jsx(u,{size:{xs:12},children:e.jsxs(u,{container:!0,alignItems:"center",justifyContent:"center",children:[e.jsx(u,{size:{xs:12},children:e.jsx(S,{children:e.jsx(C,{title:t("Client ID",{client_id:c?.client_id})||"Client ID: "+c?.client_id,children:e.jsx(Me,{className:i.clientDescription,children:c.client_description!==""?c.client_description:c?.client_id})})})}),e.jsx(u,{size:{xs:12},children:e.jsxs(S,{children:[t("The above application is requesting the following permissions"),":"]})}),e.jsx(Ss,{scopes:c.scopes}),e.jsx(ws,{claims:c.claims,essential_claims:c.essential_claims,onChangeChecked:n=>ye(n)}),c?.require_login?e.jsx(u,{size:{xs:12},marginY:a.spacing(2),children:e.jsx(Qe,{id:"openid-consent-prompt-login",children:e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{size:{xs:12},children:e.jsx(C,{title:t("You must reauthenticate to be able to give consent"),children:e.jsx(Ze,{id:"password-textfield",label:t("Password",{ns:"portal"}),variant:"outlined",inputRef:_,onKeyDown:_e,onKeyUp:ke,error:we,disabled:z,value:g,onChange:n=>U(n.target.value),onFocus:()=>q(!1),type:B?"text":"password",autoComplete:"current-password",required:!0,fullWidth:!0,slotProps:{input:{endAdornment:e.jsx(es,{position:"end",children:e.jsx(Ee,{"aria-label":"toggle password visibility",edge:"end",size:"large",onMouseDown:()=>j(!0),onMouseUp:()=>j(!1),onMouseLeave:()=>j(!1),onTouchStart:()=>j(!0),onTouchEnd:()=>j(!1),onTouchCancel:()=>j(!1),onKeyDown:n=>{n.key===" "&&(j(!0),n.preventDefault())},onKeyUp:n=>{n.key===" "&&(j(!1),n.preventDefault())},children:B?e.jsx(ss,{}):e.jsx(ts,{})})})}}})})}),ge?e.jsx(u,{size:{xs:12},marginX:2,children:e.jsxs(Ne,{severity:"warning",children:[e.jsx(ns,{children:t("Warning",{ns:"portal"})}),xe?t("The password was partially entered with Caps Lock",{ns:"portal"}):t("The password was entered with Caps Lock",{ns:"portal"})]})}):null]})})}):null,e.jsx(ys,{pre_configuration:c.pre_configuration,onChangePreConfiguration:Se}),e.jsx(u,{size:{xs:12},children:e.jsxs(u,{container:!0,spacing:1,children:[e.jsx(u,{size:{xs:6},children:e.jsx(C,{title:t(K?"You must reauthenticate to be able to give consent":"Accept this consent request"),children:e.jsx("span",{children:e.jsx(ee,{id:"openid-consent-accept",className:i.button,disabled:!c||K||z,onClick:D,color:"primary",variant:"contained",endIcon:je?e.jsx(Z,{size:20}):null,children:t("Accept",{ns:"portal"})})})})}),e.jsx(u,{size:{xs:6},children:e.jsx(C,{title:t("Deny this consent request"),children:e.jsx("span",{children:e.jsx(ee,{id:"openid-consent-deny",className:i.button,disabled:!c||z,onClick:Le,color:"secondary",variant:"contained",endIcon:Ce?e.jsx(Z,{size:20}):null,children:t("Deny",{ns:"portal"})})})})})]})})]})})]})}):e.jsx(S,{children:e.jsx(qe,{})})})},_s=A()(s=>({clientDescription:{fontWeight:600},button:{marginLeft:s.spacing(),marginRight:s.spacing(),width:"100%"}}));export{qs as default};
