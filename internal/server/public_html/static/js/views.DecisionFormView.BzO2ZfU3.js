import{M as x,j as e,bh as oe,bi as ae,an as Ae,bj as U,bk as ie,a4 as Pe,bl as De,u as k,m as z,r as a,G as u,B as S,o as Ie,c as Fe,k as Re,i as Te,A as Ue,I as F,bm as W,bn as Y,bo as J,aJ as X,bp as Q,e as Z,T as Me,t as Ee,ak as Be,q as ee,L as Ne}from"./index.J4YSomth.js";import{L as Ve}from"./components.LogoutButton.DMRxt6GR.js";import{S as $e}from"./components.SwitchUserButton.jGsmCeD4.js";import{b as ce,T as w,e as qe,f as He,j as Oe,B as se}from"./constants.constants.BvDkw1BZ.js";import{u as Ke}from"./hooks.OpenIDConnect.fHo8fPKW.js";import{L as Ge}from"./layouts.Login.CRKTUBU4.js";import{b as We,I as Ye}from"./services.Password.B3E9NQ0q.js";import{F as R}from"./mui.FormControlLabel.D2nRzGhM.js";import{C as T,B as Je}from"./broadcast-channel.VqNLyvA6.js";import{L as Xe}from"./mui.ListItem.CktSzIFS.js";import{F as Qe,T as Ze}from"./mui.TextField.oVnBvIhZ.js";import{I as es,V as ss,a as ts,A as ns}from"./mui.VisibilityOff.BbFGBtcl.js";import"./components.TypographyWithTooltip.DDFBjLT9.js";const rs=x(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6m7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58z"})),os=x(e.jsx("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6m6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26"})),as=x(e.jsx("path",{d:"M20 0H4v2h16zM4 24h16v-2H4zM20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m-8 2.75c1.24 0 2.25 1.01 2.25 2.25s-1.01 2.25-2.25 2.25S9.75 10.24 9.75 9 10.76 6.75 12 6.75M17 17H7v-1.5c0-1.67 3.33-2.5 5-2.5s5 .83 5 2.5z"})),is=x(e.jsx("path",{d:"M21.99 8c0-.72-.37-1.35-.94-1.7L12 1 2.95 6.3C2.38 6.65 2 7.28 2 8v10c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2zM12 13 3.74 7.84 12 3l8.26 4.84z"})),cs=x(e.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"})),ls=x(e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})),us=x(e.jsx("path",{d:"M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m6-9h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h1.9c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m0 12H6V10h12z"})),ds=x(e.jsx("path",{d:"M16 1H8C6.34 1 5 2.34 5 4v16c0 1.66 1.34 3 3 3h8c1.66 0 3-1.34 3-3V4c0-1.66-1.34-3-3-3m-2 20h-4v-1h4zm3.25-3H6.75V4h10.5z"})),ps=x([e.jsx("path",{d:"m21 5-9-4-9 4v6c0 5.55 3.84 10.74 9 12 2.3-.56 4.33-1.9 5.88-3.71l-3.12-3.12c-1.94 1.29-4.58 1.07-6.29-.64-1.95-1.95-1.95-5.12 0-7.07s5.12-1.95 7.07 0c1.71 1.71 1.92 4.35.64 6.29l2.9 2.9C20.29 15.69 21 13.38 21 11z"},"0"),e.jsx("circle",{cx:"12",cy:"12",r:"3"},"1")]),le="openid",ue="offline_access",de="profile",pe="groups",fe="email",he="phone",me="address",ge="authelia.bearer.authz";function fs(s){switch(s){case le:return e.jsx(rs,{});case ue:return e.jsx(os,{});case de:return e.jsx(as,{});case pe:return e.jsx(cs,{});case fe:return e.jsx(is,{});case he:return e.jsx(ds,{});case me:return e.jsx(ls,{});case ge:return e.jsx(us,{});default:return e.jsx(ps,{})}}function hs(s){switch(s){case le:return"Use OpenID to verify your identity";case ue:return"Automatically refresh these permissions without user interaction";case de:return"Access your profile information";case pe:return"Access your group membership";case fe:return"Access your email addresses";case he:return"Access your phone number";case me:return"Access your address";case ge:return"Access protected resources logged in as you";default:return s}}function te(s,t){const r=new URLSearchParams;return s&&r.append(oe,s),t&&r.append(ae,t),Ae(`${U}?${r.toString()}`)}function ms(s,t,r,i,p,m){return ie(U,{claims:r,client_id:t,consent:!0,flow_id:i,pre_configure:s,subflow:p,user_code:m})}function gs(s,t){const r=new URLSearchParams;return r.append(oe,s),r.append(ae,t),Pe.put(De,r)}function xs(s,t,r,i){return ie(U,{client_id:s,consent:!1,flow_id:t,pre_configure:!1,subflow:r,user_code:i})}function js(s,t){return!s.startsWith("scopes.")&&s!==""?s:hs(t)}function ne(s,t){return!s.startsWith("claims.")&&s!==""?s:Cs(t)}function Cs(s){switch(s){case"name":return"Display Name";case"sub":return"Unique Identifier";case"zoneinfo":return"Timezone";case"locale":return"Locale / Language";case"updated_at":return"Information Updated Time";case"profile":case"website":case"picture":return`${re(s)} URL`;default:return re(s)}}function re(s){s=(s.charAt(0).toUpperCase()+s.slice(1)).replace("_verified"," (Verified)").replace("_"," ");let t="";for(let r=0;r<s.length;r++)r===0||s[r-1]===" "?t+=s[r].toUpperCase():t+=s[r];return t}const ws=({claims:s,essential_claims:t,onChangeChecked:r})=>{const{t:i}=k(["consent"]),{classes:p}=bs(),m=a.useMemo(()=>s||[],[s]),f=o=>{const l=!m.includes(o.target.value);r(l?[...m,o.target.value]:m.filter(h=>h!==o.target.value))},v=a.useCallback(o=>m.includes(o),[m]),j=t||s;return e.jsx(a.Fragment,{children:j?e.jsx(u,{size:{xs:12},children:e.jsx(S,{className:p.container,children:e.jsxs(ce,{className:p.list,children:[t?.map(o=>e.jsx(w,{title:i("Claim",{name:o}),children:e.jsx(R,{control:e.jsx(T,{id:`claim-${o}-essential`,disabled:!0,checked:!0}),label:ne(i(`claims.${o}`),o)})},`${o}-essential`)),s?.map(o=>e.jsx(w,{title:i("Claim",{name:o}),children:e.jsx(R,{control:e.jsx(T,{id:"claim-"+o,value:o,checked:v(o),onChange:f}),label:ne(i(`claims.${o}`),o)})},o))]})})}):null})},bs=z()(s=>({container:{textAlign:"center"},list:{backgroundColor:s.palette.background.paper,display:"inline-block",marginBottom:s.spacing(2),marginTop:s.spacing(2)}})),ys=s=>{const{t}=k(["consent"]),{classes:r}=vs(),[i,p]=a.useState(!1),m=()=>{p(f=>!f)};return a.useEffect(()=>{s.onChangePreConfiguration(i)},[i,s]),e.jsx(a.Fragment,{children:s.pre_configuration?e.jsx(u,{size:{xs:12},children:e.jsx(w,{title:t("This saves this consent as a pre-configured consent for future use"),children:e.jsx(R,{control:e.jsx(T,{id:"pre-configure",checked:i,onChange:m,value:"preConfigure",color:"primary"}),className:r.preConfigure,label:t("Remember Consent")})})}):null})},vs=z()(()=>({preConfigure:{}})),Ss=s=>{const{t}=k(["consent"]),{classes:r}=Ls();return e.jsx(u,{size:{xs:12},children:e.jsx(S,{className:r.scopesListContainer,children:e.jsx(ce,{className:r.scopesList,children:s.scopes.map(i=>e.jsx(w,{title:t("Scope",{name:i}),children:e.jsxs(Xe,{id:"scope-"+i,dense:!0,children:[e.jsx(qe,{children:fs(i)}),e.jsx(He,{primary:js(t(`scopes.${i}`),i)})]},i)},i))})})})},Ls=z()(s=>({scopesList:{backgroundColor:s.palette.background.paper,display:"inline-block",marginBottom:s.spacing(2),marginTop:s.spacing(2)},scopesListContainer:{textAlign:"center"}})),Ns=s=>{const{t}=k(["consent","portal"]),r=Ie(),{classes:i}=_s(),{createErrorNotification:p,resetNotification:m}=Fe(),f=Re(),v=Te(),{flow:j,id:o,subflow:l}=Oe(),h=Ke(),[g,M]=a.useState(""),[xe,E]=a.useState(!1),[je,B]=a.useState(!1),[A,y]=a.useState(!1),[Ce,L]=a.useState(!1),[we,N]=a.useState(!1),[be,V]=a.useState(!1),[$,C]=a.useState(!1),[c,q]=a.useState(),[P,ye]=a.useState(void 0),[D,H]=a.useState([]),[O,ve]=a.useState(!1),K=a.useMemo(()=>new Je("login"),[]),_=a.useRef(null),Se=n=>{ve(n)};a.useEffect(()=>{s.state.authentication_level===Ue.Unauthenticated?f(F):o||h?te(o,h).then(n=>{q(n),H(n.claims||[])}).catch(n=>{ye(n)}):f(F)},[o,f,s.state.authentication_level,h]),a.useEffect(()=>{P&&(f(F),console.error(`Unable to display consent screen: ${P.message}`))},[f,m,p,P]);const b=a.useCallback(()=>{_.current!==null&&_.current.focus()},[_]),I=a.useCallback(async()=>{if(!c)return;if(c.require_login){if(g.length===0){V(!0),b();return}y(!0),L(!0);try{await We(g,void 0,void 0,o,j,l,h),await K.postMessage(!0)}catch(ze){console.error(ze),p(t("Failed to confirm your identity",{ns:"portal"})),M(""),y(!1),L(!1),b();return}const d=await te(o,h);if(q(d),d.require_login){p(t("Failed to confirm your identity",{ns:"portal"}));return}}else y(!0),L(!0);const n=await ms(O,c.client_id,D,o,l,h);if(y(!1),L(!1),(!l||l==="")&&n.redirect_uri)v(n.redirect_uri);else if(l&&l===W)if(n.flow_id&&h){await gs(n.flow_id,h);const d=new URLSearchParams;j&&d.set(Y,j),l&&d.set(J,l),d.set(X,"accepted"),f(Q+Z,!1,!1,!1,d)}else throw p(t("Failed to submit the user code")),new Error("Failed to perform user code submission");else throw p(t("Failed to redirect you",{ns:"portal"})),new Error("Unable to redirect the user")},[D,p,j,o,b,K,f,g,O,v,c,l,t,h]),Le=async()=>{if(!c)return;y(!0),N(!0);const n=await xs(c.client_id,o,l,h);if(y(!1),N(!1),(!l||l==="")&&n.redirect_uri)v(n.redirect_uri);else if(l&&l===W){const d=new URLSearchParams;j&&d.set(Y,j),l&&d.set(J,l),d.set(X,"rejected"),f(Q+Z,!1,!1,!1,d)}else throw new Error("Unable to redirect the user")};a.useEffect(()=>{const n=setTimeout(()=>b(),10);return()=>clearTimeout(n)},[b]);const _e=a.useCallback(n=>{n.key==="Enter"&&(n.preventDefault(),g.length===0?b():I().catch(console.error))},[b,I,g.length]),ke=a.useCallback(n=>{if(g.length<=1&&(E(!1),B(!1),g.length===0))return;const d=Ye(n);d!==null&&(d?E(!0):B(!0))},[g.length]),G=c?.require_login&&g.length===0;return e.jsx(a.Fragment,{children:s.userInfo&&c!==void 0?e.jsx(Ge,{id:"openid-consent-decision-stage",title:`${t("Hi",{ns:"portal"})} ${s.userInfo.display_name}`,subtitle:t("Consent Request"),children:e.jsxs(u,{container:!0,direction:"column",justifyContent:"center",alignItems:"center",children:[e.jsxs(u,{size:{xs:12},sx:{paddingBottom:r.spacing(2)},children:[e.jsx(Ve,{})," "," | "," ",e.jsx($e,{})]}),e.jsx(u,{size:{xs:12},children:e.jsxs(u,{container:!0,alignItems:"center",justifyContent:"center",children:[e.jsx(u,{size:{xs:12},children:e.jsx(S,{children:e.jsx(w,{title:t("Client ID",{client_id:c?.client_id})||"Client ID: "+c?.client_id,children:e.jsx(Me,{className:i.clientDescription,children:c.client_description===""?c?.client_id:c.client_description})})})}),e.jsx(u,{size:{xs:12},children:e.jsxs(S,{children:[t("The above application is requesting the following permissions"),":"]})}),e.jsx(Ss,{scopes:c.scopes}),e.jsx(ws,{claims:D,essential_claims:c.essential_claims,onChangeChecked:n=>H(n)}),c?.require_login?e.jsx(u,{size:{xs:12},marginY:r.spacing(2),children:e.jsx(Qe,{id:"openid-consent-prompt-login",children:e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{size:{xs:12},children:e.jsx(w,{title:t("You must reauthenticate to be able to give consent"),children:e.jsx(Ze,{id:"password-textfield",label:t("Password",{ns:"portal"}),variant:"outlined",inputRef:_,onKeyDown:_e,onKeyUp:ke,error:be,disabled:A,value:g,onChange:n=>M(n.target.value),onFocus:()=>V(!1),type:$?"text":"password",autoComplete:"current-password",required:!0,fullWidth:!0,slotProps:{input:{endAdornment:e.jsx(es,{position:"end",children:e.jsx(Ee,{"aria-label":"toggle password visibility",edge:"end",size:"large",onMouseDown:()=>C(!0),onMouseUp:()=>C(!1),onMouseLeave:()=>C(!1),onTouchStart:()=>C(!0),onTouchEnd:()=>C(!1),onTouchCancel:()=>C(!1),onKeyDown:n=>{n.key===" "&&(C(!0),n.preventDefault())},onKeyUp:n=>{n.key===" "&&(C(!1),n.preventDefault())},children:$?e.jsx(ss,{}):e.jsx(ts,{})})})}}})})}),xe?e.jsx(u,{size:{xs:12},marginX:2,children:e.jsxs(Be,{severity:"warning",children:[e.jsx(ns,{children:t("Warning",{ns:"portal"})}),je?t("The password was partially entered with Caps Lock",{ns:"portal"}):t("The password was entered with Caps Lock",{ns:"portal"})]})}):null]})})}):null,e.jsx(ys,{pre_configuration:c.pre_configuration,onChangePreConfiguration:Se}),e.jsx(u,{size:{xs:12},children:e.jsxs(u,{container:!0,spacing:1,children:[e.jsx(u,{size:{xs:6},children:e.jsx(w,{title:t(G?"You must reauthenticate to be able to give consent":"Accept this consent request"),children:e.jsx("span",{children:e.jsx(se,{id:"openid-consent-accept",className:i.button,disabled:!c||G||A,onClick:I,color:"primary",variant:"contained",endIcon:Ce?e.jsx(ee,{size:20}):null,children:t("Accept",{ns:"portal"})})})})}),e.jsx(u,{size:{xs:6},children:e.jsx(w,{title:t("Deny this consent request"),children:e.jsx("span",{children:e.jsx(se,{id:"openid-consent-deny",className:i.button,disabled:!c||A,onClick:Le,color:"secondary",variant:"contained",endIcon:we?e.jsx(ee,{size:20}):null,children:t("Deny",{ns:"portal"})})})})})]})})]})})]})}):e.jsx(S,{children:e.jsx(Ne,{})})})},_s=z()(s=>({button:{marginLeft:s.spacing(),marginRight:s.spacing(),width:"100%"},clientDescription:{fontWeight:600}}));export{Ns as default};
