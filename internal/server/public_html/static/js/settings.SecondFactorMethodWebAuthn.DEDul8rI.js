import{r as i,u as f,j as S}from"./index.CEiXDjRd.js";import{W as y}from"./components.WebAuthnTryIcon.DDoO3elY.js";import{u as m}from"./hooks.Mounted.Bd30MWyg.js";import{W as e,j as w,e as W,h as b,i as F,k as R}from"./services.WebAuthn.CccHG5Sl.js";import"./components.FailureIcon.BImOlKSw.js";import"./components.SuccessIcon.9My8fVrT.js";import"./components.TimerIcon.Cc0aXxNj.js";import"./constants.constants.RkJrtp09.js";import"./hooks.Timer.ChDcUIwL.js";import"./portal.IconWithContext.CGRNMh1Q.js";import"./browserSupportsWebAuthn.Bhlk1eaM.js";const A={started:!1,status:e.WaitTouch};function T(s,r){switch(r.type){case"setStatus":return{...s,status:r.status};case"setStarted":return{...s,started:r.started};default:return s}}const P=function(s){const[r,t]=i.useReducer(T,A),a=m(),{t:o}=f(),{started:c,status:d}=r,h=()=>{t({status:e.WaitTouch,type:"setStatus"}),t({started:!1,type:"setStarted"})},l=i.useCallback(async()=>{t({started:!0,type:"setStarted"});try{const u=await w();if(u.status!==200||u.options==null){t({status:e.Failure,type:"setStatus"}),console.error(new Error(o("Failed to initiate security key sign in process")));return}const n=await W(u.options);if(n.result!==b.Success){if(!a.current)return;t({status:e.Failure,type:"setStatus"}),console.error(new Error(o(F(n.result))));return}if(n.response==null){console.error(new Error(o("The browser did not respond with the expected attestation data"))),t({status:e.Failure,type:"setStatus"});return}if(!a.current)return;t({status:e.InProgress,type:"setStatus"});const p=await R(n.response);if(p.data.status==="OK"&&p.status===200){s.onSecondFactorSuccess();return}if(!a.current)return;console.error(new Error(o("The server rejected the security key"))),t({status:e.Failure,type:"setStatus"})}catch(u){if(!a.current)return;console.error(u),t({status:e.Failure,type:"setStatus"})}},[a,s,o]);return i.useEffect(()=>{c||l().catch(console.error)},[l,c]),S.jsx(y,{onRetryClick:h,webauthnTouchState:d})};export{P as default};
