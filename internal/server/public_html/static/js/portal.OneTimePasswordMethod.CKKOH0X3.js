import{u as D,g as j,h as A,r as t,A as l,j as g,B as k,L as y}from"./index.Cnoc1xvA.js";import{j as U}from"./constants.constants.C7XWv2Yg.js";import{u as M}from"./hooks.Mounted.zqJHXAmG.js";import{u as B}from"./hooks.OpenIDConnect.DIXavwCS.js";import{a as H,S as r,b as N,O as Y}from"./portal.OTPDial.BPtTHx6v.js";import{D as _,S as T}from"./portal.MethodContainer.BjdCDRHJ.js";import"./components.SuccessIcon.DhmnFkmE.js";import"./components.TimerIcon.7hnoDN64.js";import"./portal.IconWithContext.DucLu93y.js";import"./components.InformationIcon.DesXiPIb.js";import"./portal.Authenticated.DmyQJIWb.js";const p=function(e){const{t:n}=D(),E=j(A),{id:S,flow:w,subflow:L}=U(),R=B(),[c,I,,d]=H(),[f,v]=t.useState(""),[x,i]=t.useState(e.authenticationLevel===l.TwoFactor?r.Success:r.Idle),{onSignInSuccess:F,onSignInError:b}=e,a=t.useRef(b).current,C=t.useRef(F).current,s=t.useRef(null),u=M();t.useEffect(()=>()=>{s.current!==null&&(clearTimeout(s.current),s.current=null)},[]),t.useEffect(()=>{d&&(console.error(d),a(new Error(n("Could not obtain user settings"))),i(r.Failure))},[a,d,n]),t.useEffect(()=>{e.registered&&e.authenticationLevel===l.OneFactor&&I()},[I,e.authenticationLevel,e.registered]);const O=t.useCallback(m=>{s.current&&clearTimeout(s.current),i(r.RateLimited),a(new Error(n("You have made too many requests"))),s.current=setTimeout(()=>{if(!u.current){s.current=null;return}i(r.Idle),s.current=null},m*1e3)},[u,a,n]),P=t.useCallback(async()=>{if(!e.registered||e.authenticationLevel===l.TwoFactor)return;const m=`${f}`;if(!(!f||m.length!==(c?.digits||6))){try{i(r.InProgress);const o=await N(m,E,S,w,L,R);if(!u.current)return;o?o.limited?O(o.retryAfter):(i(r.Success),C(o&&o.data?o.data.redirect:void 0)):(a(new Error(n("The One-Time Password might be wrong"))),i(r.Failure))}catch(o){if(console.error(o),!u.current)return;a(new Error(n("The One-Time Password might be wrong"))),i(r.Failure)}v("")}},[e.registered,e.authenticationLevel,f,c?.digits,E,S,w,L,R,a,n,C,O,u]);t.useEffect(()=>{e.authenticationLevel>=l.TwoFactor&&i(r.Success)},[e.authenticationLevel,i]),t.useEffect(()=>{P().catch(console.error)},[P]);let h=T.METHOD;return e.authenticationLevel===l.TwoFactor?h=T.ALREADY_AUTHENTICATED:e.registered||(h=T.NOT_REGISTERED),g.jsx(_,{id:e.id,title:n("One-Time Password"),explanation:n("Enter One-Time Password"),duoSelfEnrollment:!1,registered:e.registered,state:h,onRegisterClick:e.onRegisterClick,children:g.jsx(k,{children:c!==void 0||d!==void 0?g.jsx(Y,{passcode:f,period:c?.period||30,digits:c?.digits||6,onChange:v,state:x}):g.jsx(y,{})})})};export{p as default};
