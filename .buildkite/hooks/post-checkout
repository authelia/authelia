#!/usr/bin/env bash

FILE="/buildkite/hooks/environment"
FILE="/tmp/aa"

KEY=$(openssl rand -hex 32)

PUBKEY='-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAsItCvjCeQbDPQEWZM8Ai
bJnvSZKutXaAVf8tNtOpJnbrmjE0Eau/v2Pd9xNvc1dJdZlKdcwDbacAupiB/0d0
0EM7jwyRnn3nAaK5pIAu/U4FttlVURf1Ce37b77odLvil58bB/1C0///juRDWdQU
V0K2rz20N2RodOOjLXlCrLfaxNmihY5dMPxz4EoLyuiDW6WXfEDx5Kj1jU4oMRIK
a57gMfSCTv60yjUoDDUHD6o5YAixWRcCMnapckusPaKeGAfAE8vifhHleuxh8dqL
+AGr3Kt+nwFEyxndScFWLacqthI/gQsqF2cGGPJqsYOllV4RnmI+cr47DPH28Xlm
YQIDAQAB
-----END PUBLIC KEY-----'

# Encrypt with inline public key
echo "data"
openssl enc -aes-256-ecb -K "$KEY" -in "$FILE" | base64
echo "key"
openssl rsautl -encrypt -pubin -inkey <(echo "$PUBKEY") -in <(echo "$KEY" | xxd -r -p) | base64

